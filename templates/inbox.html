{% extends 'base.html' %} {% block content %}

<script>
    async function fetchInbox() {
        const response = await fetch('/fetch-emails');
        const data = await response.json();
        const { email_address, messages } = data;

        // Store the email address in local/session storage
        sessionStorage.setItem('email_address', email_address);

        messages.forEach((message) => {
            if (!message.isRead) {
                console.log(message);

                const sectionEmails = document.querySelector('.section-emails');
                const figureEl = document.createElement('figure');
                const fromEmailAddressEl = document.createElement('p');
                const fromNameEl = document.createElement('p');
                const emailSubjectEl = document.createElement('p');

                fromEmailAddressEl.textContent =
                    message.from.emailAddress.address;
                fromNameEl.textContent = message.from.emailAddress.name;
                emailSubjectEl.textContent = message.subject;

                figureEl.appendChild(fromEmailAddressEl);
                figureEl.appendChild(fromNameEl);
                figureEl.appendChild(emailSubjectEl);

                sectionEmails.appendChild(figureEl);
            }
        });
    }
    window.onload = fetchInbox;
</script>

<!-- MAIN -->
<main>
    <section class="section-emails"></section>
</main>
{% endblock content %}
